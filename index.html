<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JamBuddy — Your Real-Time Musical Co-Pilot</title>
  <meta name="description" content="JamBuddy listens to what you play in real time and helps you understand chords, keys, scales, and progressions. Your musical co-pilot." />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div id="loading">
    <div class="loading-inner">
      <span class="loading-name">JamBuddy</span>
      <span class="loading-text">Loading presentation…</span>
    </div>
  </div>

  <div id="slides"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const container = document.getElementById('slides');
    const loading = document.getElementById('loading');

    pdfjsLib.getDocument('jamBuddypresentationstatic.pdf').promise.then(function(pdf) {
      const total = pdf.numPages;
      const wrappers = [];

      // Pre-create all wrappers to preserve slide order
      for (let i = 1; i <= total; i++) {
        const wrapper = document.createElement('div');
        wrapper.className = 'slide';
        wrapper.id = 'slide-' + i;
        const canvas = document.createElement('canvas');
        wrapper.appendChild(canvas);
        container.appendChild(wrapper);
        wrappers.push({ wrapper, canvas });
      }

      // Render each page
      const renderPage = function(pageNum) {
        return pdf.getPage(pageNum).then(function(page) {
          const scale = 2;
          const viewport = page.getViewport({ scale });
          const { canvas } = wrappers[pageNum - 1];
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          return page.render({
            canvasContext: canvas.getContext('2d'),
            viewport
          }).promise;
        }).then(function() {
          if (pageNum === 1) {
            loading.classList.add('hidden');
          }
        });
      };

      // Render all pages (parallel but display in order due to pre-created slots)
      const promises = [];
      for (let i = 1; i <= total; i++) {
        promises.push(renderPage(i));
      }
      return Promise.all(promises).then(addOverlays);

    }).catch(function(err) {
      loading.innerHTML = '<div class="loading-inner"><span class="loading-name">JamBuddy</span><span class="loading-text">Could not load presentation.</span></div>';
      console.error(err);
    });

    function addOverlays() {
      // Helper: create an absolutely-positioned overlay div
      function makeOverlay(left, top, width, height) {
        var el = document.createElement('div');
        el.className = 'slide-overlay';
        el.style.left = left;
        el.style.top = top;
        el.style.width = width;
        el.style.height = height;
        return el;
      }

      // Helper: create a clickable link overlay
      function makeLink(href, left, top, width, height) {
        var a = document.createElement('a');
        a.className = 'slide-overlay-link';
        a.href = href;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.style.left = left;
        a.style.top = top;
        a.style.width = width;
        a.style.height = height;
        return a;
      }

      // Slide 3: Animated mascot GIF
      var slide3 = document.getElementById('slide-3');
      if (slide3) {
        var gifOverlay = makeOverlay('2.34%', '45.93%', '20.83%', '46.30%');
        var gif = document.createElement('img');
        gif.src = 'assets/images/mascot.gif';
        gif.alt = 'JamBuddy mascot';
        gifOverlay.appendChild(gif);
        slide3.appendChild(gifOverlay);
      }

      // Slide 4: Video + high-res mascot
      var slide4 = document.getElementById('slide-4');
      if (slide4) {
        // Video overlay
        var videoOverlay = makeOverlay('20.36%', '47.65%', '42.57%', '40.87%');
        var video = document.createElement('video');
        video.src = 'assets/videos/LickCompressed.mp4';
        video.autoplay = true;
        video.muted = true;
        video.loop = true;
        video.playsInline = true;
        videoOverlay.appendChild(video);
        slide4.appendChild(videoOverlay);

        // High-res mascot overlay
        var mascotOverlay = makeOverlay('-6.71%', '29.26%', '17.08%', '44.14%');
        mascotOverlay.style.transform = 'scaleX(-1)';
        var mascot = document.createElement('img');
        mascot.src = 'assets/images/mascot-static.png';
        mascot.alt = 'JamBuddy mascot';
        mascotOverlay.appendChild(mascot);
        slide4.appendChild(mascotOverlay);
      }

      // Slide 9: YouTube links
      var slide9 = document.getElementById('slide-9');
      if (slide9) {
        var ytUrl = 'https://www.youtube.com/watch?v=Afwt6x60jWw';
        slide9.appendChild(makeLink(ytUrl, '3.92%', '7.32%', '26.90%', '33.10%'));
        slide9.appendChild(makeLink(ytUrl, '0%', '22.26%', '27.98%', '15.55%'));
      }

      // Slide 10: Website link (moved up) + Instagram credit links
      var slide10 = document.getElementById('slide-10');
      if (slide10) {
        // Website link
        slide10.appendChild(makeLink(
          'https://merken19.github.io/jamBuddyWebsite/',
          '52.08%', '72.40%', '42.86%', '3.54%'
        ));
        // @ycapkinn_art (illustrations) — top half of credits textbox
        slide10.appendChild(makeLink(
          'https://www.instagram.com/ycapkinn_art/',
          '54.58%', '82.59%', '39.79%', '6.98%'
        ));
        // @mcapkin_ink (mascots) — bottom half of credits textbox
        slide10.appendChild(makeLink(
          'https://www.instagram.com/mcapkin_ink/',
          '54.58%', '89.57%', '39.79%', '6.98%'
        ));
      }
    }
  </script>

</body>
</html>
